<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>template.js</title>


    <script id="testTemplate" type="text/template">
        <div>
            #for(item){
                <div>
                    <a d="{item.b}" class="item.b">{item.i}</a>
                </div>
                if(item.b>0){
                    <div>
                        <a href="#">测试链接</a>
                    </div>
                }
            }
            #if{
                <div></div>
                if(a>b){
                    
                }
            }


        </div>  
    </script>
</head>
<body>
    <script>

/*先分离，然后再加#，然后一层一层解析：每一层解析包括：操作符 html，嵌套的if,for，数据参数等。*/
/*Step1 拆分代码块 */

var dc="for|#for";

console.log("是否符合",dc.match(/[\#](for|if|else if|else)/));


var fc=new Function("a","b","for(var i=0;i<a;i++){ console.log('这是循环添加,',i); }");

console.log(fc(3,4));


var templateObj={
    mark:"@1",
    render:{
        operator:"",
        express:"",
        html:"",
        data:"",
        reder:{
            
        }
    }
}



var templateBuilder={
    /*模板标识Id*/
    mark:0,

    /*分割代码段*/
    splitBlock:function(str){
        var reg=/\#(for|if|else if|else).*?\{(.*?)[^\#]+\}/ig;
        str=str.replace(/[\n\r]|[\s]{2}/ig,"");
       
 

        return str.match(reg);
    },

    /*去除最外层{}符号*/
    removeBlockChar:function(str){
        var startBlock=str.indexOf("{"),
        endBlock=str.lastIndexOf("}");

        if(startBlock>-1&&endBlock>-1){
            str=str.substring(startBlock+1,endBlock-1);
        }

        return str;
    },

    /*生成模板标记*/
    setMark:function(array,str){

        if(array===undefined||array.length===0){
            return str;
        }
        array.forEach(function(item,index,ary){
            console.log("标记是",item);
            str=str.replace(item,"@1");
        });

        return str;
    },

    /*为模板关键字添加特殊’解析符号#’*/
    addSymbol:function(str){
        var keywords=['for','if','else if','else']; 
      
        keywords.forEach(function(item,index,ary){          
            var reg=new RegExp(ary[index],"ig");
            str=str.replace(reg,"#"+ary[index]);
        });

        return str;
    },

    /*获取渲染的html代码块*/
    getHtml:function(str){
    
    },
    /*获取渲染模板内容*/
    getCode(str){        
        return str.match(/\{(.*)\}/ig)[0];
    },
    /*获取操作符*/
    getOperator:function(str){
        return str.match(/(for|if|else if|else)/)[0];
    },

    /*获取表达式*/
    getExpress:function(str){
        return str.match(/\((.*?)\)/)[0];
    },

    createTemplate(){
        
    }

}

var dc="0";

window.eval("for(var index=0;index<3;index++){ console.log('3343'); }  dc=44311111;");

console.log("这是eval生存的dc",dc);




var renderHtml=document.getElementById("testTemplate").innerHTML;
console.log("html",renderHtml);
console.log("split block",templateBuilder.splitBlock(renderHtml));
var rederBlock=templateBuilder.splitBlock(renderHtml);





rederBlock.forEach(function(item,index,array){
    console.log("索引是："+index,array[index]);
    array[index]=templateBuilder.addSymbol(array[index]);
});

var t1=rederBlock[0];

var htmlReg=/(for|if|else if|else)(.*?)\{|\{(.*?)\}/ig;

var dc=null;
var ary=[];

ary.push(htmlReg.exec(t1));
ary.push(htmlReg.exec(t1));
ary.push(htmlReg.exec(t1));
ary.push(htmlReg.exec(t1));
ary.push(htmlReg.exec(t1));
console.log("ary",ary);







    </script>
</body>
</html>